(this.webpackJsonpLivePlayer=this.webpackJsonpLivePlayer||[]).push([[2],{91:function(e,t,n){var o;window,o=function(){return n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=n(19);function r(){}var i={trace:r,debug:r,log:r,warn:r,info:r,error:r},s=i;var a=(0,n.getSelfScope)();function u(i){var s=a.console[i];return s?function(){for(var e,t,n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];o[0]&&(o[0]=(e=i,t=o[0],t="["+e+"] > "+t)),o&&s.apply(a.console,o)}:r}t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":o(e))){!function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];n.forEach(function(e){s[e]=t[e]?t[e].bind(t):u(e)})}(e,"trace","debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i},t.logger=s},function(e,t,n){"use strict";e.exports=function(t,n,o,r){var i,s=self||window;try{try{try{i=new s.Blob([t])}catch(e){(i=new(s.BlobBuilder||s.WebKitBlobBuilder||s.MozBlobBuilder||s.MSBlobBuilder)).append(t),i=i.getBlob()}var e=s.URL||s.webkitURL,a=e.createObjectURL(i),u=new s[n](a,o);return e.revokeObjectURL(a),u}catch(e){return new s[n]("data:application/javascript,".concat(encodeURIComponent(t)),o)}}catch(e){if(r)return new s[n](r,o);throw Error("Inline worker is not supported")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMsg=t.replaceHttpByWS=t.checkVideoProgress=void 0,t.getMediaSource=o,t.isAndroid=r,t.isSupportedMSE=function(){if(r())return!1;var e=o(),t=window.SourceBuffer||window.WebKitSourceBuffer,e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.4d401f,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!e&&!!t},t.base64ToArrayBuffer=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},t.RawDataToUint8Array=function(e){return new Uint8Array(e)},t.getTrackId=i,t.getRealUtcFromData=s,t.doArrayBuffer=function(e){e.isInit||(this.utc=s(e.data),this.lastLoadedUTC=this.utc)},t.debugData=a,t.pad2=c,t.humanTime=function(e){var t,n,o=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return 0<e?(e=e,(t=new Date).setTime(1e3*e),o=(e=!(!1===o))?t.getHours():t.getUTCHours(),n=e?t.getMinutes():t.getUTCMinutes(),e=e?t.getSeconds():t.getUTCSeconds(),c(o)+":"+c(n)+":"+c(e)):""},t.logDM=function(e,t){t&&g.logger.log("%c "+t.type+" "+("event"===t.type?t.event:"mse_init_segment"),"background: aquamarine;",t)},t.showDispatchError=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";"data"in e&&e.data instanceof ArrayBuffer&&g.logger.error("Data:",a(e.data));g.logger.error(u(e),t),this.media&&"error"in this.media&&g.logger.error("MediaError:",this.media.error);++d>=this.opts.errorsBeforeStop&&(d=0,this.stopPromise=this.stop());this.onError&&this.onError(t,e)};var g=n(0);function o(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function r(){return-1!==navigator.userAgent.indexOf("Android")}function i(e){return e[47]}function s(e){return(e[92]<<24|e[93]<<16|e[94]<<8|e[95])+(e[96]<<24|e[97]<<16|e[98]<<8|e[99])/1e6}function a(e){e=new Uint8Array(e);return{trackId:e[47],utc:s(e),view:e}}t.checkVideoProgress=function(f,m){return function(){var e,t,n,o,r,i=f.currentTime,s=f.buffered,a=f.buffered.length;if(m)for(var u=m.sb.sourceBuffer,c=Object.keys(u),d=i-30,l=c.length-1;0<=l;l--){var h,p=c[l],p=u[p];p&&0<(h=p.buffered).length&&d>h.start(0)&&(function(e,t,n){try{for(var o=0;o<e.buffered.length;o++){var r=e.buffered.start(o),i=e.buffered.end(o),s=Math.max(r,t),a=Math.min(i,n);if(.5<Math.min(a,i)-s)return e.updating||e.remove(s,a)}}catch(e){g.logger.warn("removeBufferRange failed",e)}}(p,0,d),0,0)}m.media.readyState<=2&&2===m.media.networkState?m.onStartStalling():2<m.media.readyState&&m.onEndStalling(),a&&(s=s.end(a-1),e=Math.abs(s-i),m.playerStatsObject&&(m.playerStatsObject.bytes=m.sb.totalBytesCollected,m.playerStatsObject.updated_at=Date.now(),m.playing&&(m.playbackSegmentStart&&(r=m.playerStatsObject.application)&&(t=(o=m.media.getVideoPlaybackQuality()).corruptedVideoFrames,n=o.droppedVideoFrames,o=o.totalVideoFrames,r=r.live_duration,r+=m.playerStatsObject.updated_at-m.playbackSegmentStart,m.addPlayerStat("live_duration",!1,r),m.addPlayerStat("total_video_frames",!1,o),m.addPlayerStat("dropped_video_frames",!1,n),m.addPlayerStat("corrupted_video_frames",!1,t)),m.playbackSegmentStart=m.playerStatsObject.updated_at),m.addStat({updated_at:m.playerStatsObject.updated_at,bytes:m.sb.totalBytesCollected})),e<=m.opts.maxBufferDelay||(g.logger.log("nudge",i,"->",a?s:"-",i-s),f.currentTime=s-.2))}},t.replaceHttpByWS=function(e){return e.replace(/^http/,"ws")};var u=t.errorMsg=function(e){return"Error "+e.name+": "+e.message+"\n"+e.stack};function c(e){return e<=9?"0"+e:""+e}var d=0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VIDEO="video",t.AUDIO="audio"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_SOURCE_SOURCE_OPEN:"sourceopen",MEDIA_SOURCE_SOURCE_ENDED:"sourceended",MEDIA_SOURCE_SOURCE_CLOSE:"sourceclose",MEDIA_ELEMENT_PLAY:"play",MEDIA_ELEMENT_PAUSE:"pause",MEDIA_ELEMENT_PROGRESS:"progress",MEDIA_ELEMENT_EMPTIED:"emptied",MEDIA_ELEMENT_SUSPEND:"suspend",MEDIA_ELEMENT_STALLED:"stalled",MEDIA_ELEMENT_WAITING:"waiting",MEDIA_ELEMENT_RATECHANGE:"ratechange",MEDIA_ELEMENT_PLAYING:"playing",WS_OPEN:"open",WS_MESSAGE:"message",WS_ERROR:"error",WS_CLOSE:"close",BUFFER_UPDATE_END:"updateend",BUFFER_ERROR:"onerror",BUFFER_ABORT:"onabort"},e.exports=t.default},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=n(7),n=(n=n)&&n.__esModule?n:{default:n};t.default=n.default,e.exports=t.default},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},n=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=m(s(8)),c=m(s(20)),d=m(s(21)),l=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(s(2)),h=s(0),p=s(22),r=s(3),f=m(s(4)),i=m(s(23));function m(e){return e&&e.__esModule?e:{default:e}}var g=r.VIDEO,y=r.AUDIO;function _(e,t){var n=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=this,i=_;if(!(r instanceof i))throw new TypeError("Cannot call a class as a function");if(o.debug&&((0,h.enableLogs)(!0),window.humanTime=l.humanTime),h.logger.info("[mse-player]:",_.version),this.opts=o||{},this.media=e,this.url=t,this.firstStart=!0,this.opts.progressUpdateTime=this.opts.progressUpdateTime||500,this.opts.errorsBeforeStop=this.opts.errorsBeforeStop||1,"number"!=typeof this.opts.errorsBeforeStop||isNaN(this.opts.errorsBeforeStop))throw new Error("invalid errorsBeforeStop param, should be number");if(this.opts.connectionRetries=this.opts.connectionRetries||0,"number"!=typeof this.opts.connectionRetries||isNaN(this.opts.connectionRetries))throw new Error("invalid connectionRetries param, should be number");if(this.opts.wsReconnect=this.opts.wsReconnect||!1,"boolean"!=typeof this.opts.wsReconnect)throw new Error("invalid wsReconnect param, should be boolean");if(this.opts.preferHQ=this.opts.preferHQ||!1,"boolean"!=typeof this.opts.preferHQ)throw new Error("invalid preferHQ param, should be boolean");if(this.opts.onCrashTryVideoOnly=this.opts.onCrashTryVideoOnly||!0,"boolean"!=typeof this.opts.onCrashTryVideoOnly)throw new Error("invalid onCrashTryVideoOnly param, should be boolean");if(this.retry=0,this.retryConnectionTimer,this.opts.retryMuted=this.opts.retryMuted||!1,"boolean"!=typeof this.opts.retryMuted)throw new Error("invalid retryMuted param, should be boolean");this.opts.maxBufferDelay=this.opts.maxBufferDelay||2;r=navigator.userAgent;if((/Edge/.test(r)||/trident.*rv:1\d/i.test(r))&&(this.opts.maxBufferDelay=10),"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");if(this.opts.videoQuality){if("string"!=typeof this.opts.videoQuality)throw new Error("invalid videoQuality param, should be string");if("highest"!==this.opts.videoQuality&&"lowest"!==this.opts.videoQuality)throw new Error("invalid videoQuality param, should be highest or lowest")}try{this.Sentry=s(!function(){var e=new Error("Cannot find module '@sentry/browser'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){this.noSentry=!0}if(this.opts.sentryConfig=this.opts.sentryConfig||"","string"!=typeof this.opts.sentryConfig)throw new Error("invalid sentryConfig param, should be string");if(this.opts.sentryConfig.length&&!this.noSentry&&(this.Sentry.init({dsn:this.opts.sentryConfig,environment:"production",release:"Mse Player@"+_.version}),document.onerror=function(e){n.Sentry.captureException(e)}),this.opts.statsSendEnable=this.opts.statsSendEnable||!0,"number"!=typeof this.opts.maxBufferDelay)throw new Error("invalid maxBufferDelay param, should be number");if(window.Worker){if(this.statsWorker=new d.default,this.statsWorker.onmessage=this.onStatsWorkerMessage.bind(this),this.opts.statsSendTime){if("number"!=typeof this.opts.statsSendTime)throw new Error("invalid statsSendTime param, should be number");this.statsWorker.postMessage({command:"time",commandObj:1e3*this.opts.statsSendTime})}this.statsWorker.postMessage({command:"start",commandObj:this.url}),this.statsWorkerStarted=!0}this.resetStats=function(){n.playerStatsObject={proto:"mseld",user_agent:navigator.userAgent,bytes:0,application:{application_name:"mseld_player",application_version:_.version,stall_count:0,pause_count:0,error_count:0,reconnect_count:0,bitrate_change_count:0,live_duration:0,stall_duration:0,pause_duration:0,total_video_frames:0,dropped_video_frames:0,corrupted_video_frames:0}},n.addStat(n.playerStatsObject),n.statsWorkerStarted||(n.statsWorker.postMessage({command:"start",commandObj:n.url}),n.statsWorkerStarted=!0)},this.onProgress=o&&o.onProgress,o&&o.onDisconnect?this.onDisconnect=o&&o.onDisconnect:this.onDisconnect=function(e){h.logger.log("[websocket status]:",e)},this.onMediaInfo=o&&o.onMediaInfo,this.onError=o&&o.onError,this.onEventCallback=o&&o.onEvent,this.onAutoplay=o&&o.onAutoplay,this.onMuted=o&&o.onMuted,this.onStats=o&&o.onStats,this.onMessage=o&&o.onMessage,this.onPause=o&&o.onPause,this.onResume=o&&o.onResume,e instanceof HTMLMediaElement&&(e.WebKitPlaysInline=!0,e.controls=!1),this.ws=new u.default({message:this.dispatchMessage.bind(this),closed:this.onDisconnect.bind(this),error:this.onError,wsReconnect:this.opts.wsReconnect}),this.sb=new c.default({media:e}),this.messageTime=Date.now(),this.init()}_.replaceHttpByWS=function(e){return l.replaceHttpByWS(e)},_.isSupported=function(){return l.isSupportedMSE()},n(_,null,[{key:"version",get:function(){return"22.7.1"}}]),_.prototype.play=function(e,t){var n=this;if(h.logger.log("[mse-player]: play()"),this.playing)h.logger.log("MSE is already playing");else{if(!this.ws||!this.ws.websocket||this._pause)return this._play(e,t).then(function(){n.playing=!0,n._stop=!1,n.pendingTracks&&(n.setTracks(n.pendingTracks),n.pendingTracks=void 0)}).catch(function(e){n.onPlayerError(e),h.logger.error("[mse-player]: got error on play",e),n.playing=!1});h.logger.log("[mse-player]: websocket already opened")}},_.prototype.stop=function(){var e=this;this.playPromise?(this.onEvent({key:Date.now(),data:{event:"play_stop"}}),this.playerStatsObject.closed_at=Date.now(),this.addStat({closed_at:this.playerStatsObject.closed_at}),this.opts.statsSendEnable&&(this.statsWorkerStarted=!1),this.playPromise.catch(function(){if(e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),!e._stop)return e.onMediaDetaching();h.logger.log("[mse-player]: already stopped")}).finally(function(){if(e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0),!e._stop)return e.onMediaDetaching();h.logger.log("[mse-player]: already stopped")})):h.logger.log("[mse-player]: no playPromise exists, nothing to stop"),this.firstStart=!0,delete this.uuid},_.prototype.pause=function(){if(!function(){return!(!(!this._pause&&this.playing&&this.media&&this.ws&&this.mediaSource)||this.mediaSource&&"open"!==this.mediaSource.readyState||!this.playPromise)}.bind(this)())return h.logger.log("[mse:playback] can not do pause");var e=function(){if(this.ws.pause(),this.media.pause(),this._pause=!0,this.playing=!1,this.addPlayerStat("pause_count"),this.pauseStarted=Date.now(),this.onPause)try{this.onPause()}catch(e){h.logger.error("Error "+e.name+":"+e.message+"\n"+e.stack)}}.bind(this);this.playPromise.then(e,e).catch(e,e)},_.prototype.restart=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?void 0:this.sb.lastLoadedUTC;this.playing=!1,this.ws.destroy(),this.ws.init(),this.ws.start(this.url,e,this.videoTrack,this.audioTrack),this.addPlayerStat("reconnect_count"),this.onEndStalling()},_.prototype.retryConnection=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.retry>=this.opts.connectionRetries?clearInterval(this.retryConnectionTimer):(h.logger.log("%cconnectionRetry:","background: orange;","Retrying "+(this.retry+1)),this.mediaSource=void 0,this.init(),this.ws.destroy(),this.sb.destroy(),this.play(t,n).then(function(){e.onEndStalling()}),this.retry=this.retry+1)},_.prototype.setTracks=function(e){var n,t,o,r,i,s=this;if(this.mediaInfo){if("lowest"===e)e=this.autoTrackSelection(!1);else if("highest"===e)e=this.autoTrackSelection(!0);else if(!Array.isArray(e))return void h.logger.error('tracks should be an Array instance: ["v1", "a1"]');this.playing?(n=this.mediaInfo.streams?"streams":"tracks",t=e.filter(function(t){var e=s.mediaInfo[n].find(function(e){return t===e.track_id});return!!e&&e.content===g}).join(""),(o=e.filter(function(t){var e=s.mediaInfo[n].find(function(e){return t===e.track_id});return e?!!e&&e.content===y:null}).join("")).length||t.length||(h.logger.warn("No such stream tracks! Setting to default parameters"),r=this.getVideoTracks(),(i=this.getAudioTracks()).length?o=i[0].track_id:h.logger.warn("No audio tracks"),r.length?t=r[0].track_id:h.logger.warn("No video tracks")),o.length||(this.sb.sourceBuffer.audio&&this.sb.removeSourceBuffer(),this.media.muted=!0,h.logger.warn("No audio tracks")),t.length&&o.length&&this.mediaSource.sourceBuffers.length<=1&&(this.stop(),this.media.muted=!1,this.play()),this.onStartStalling(),this.ws.setTracks(t,o),this.addPlayerStat("bitrate_change_count"),this.videoTrack=t,this.audioTrack=o,this._setTracksFlag=!0,this.waitForInitFrame=!0):this.pendingTracks=e}else h.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},_.prototype.autoTrackSelection=function(e){var t,n,o,r,i,s,a,u,c;if(this.mediaInfo)return t=this.getVideoTracks(),n=this.getAudioTracks(),c=o=void 0,e?(i=r=void 0,t[0].bitrate?i="bitrate":t[0].pixel_width&&(i="pixel_width"),r=t[0][i],o=t[0].track_id,t.forEach(function(e){e[i]>r&&(r=e[i],o=e.track_id)}),n.length&&(c=n[0].track_id,n.forEach(function(e){e.sample_rate>r&&(c=e.track_id)}))):(a=s=void 0,t[0].bitrate?a="bitrate":t[0].pixel_width&&(a="pixel_width"),s=t[0][a],o=t[0].track_id,t.forEach(function(e){e[a]<s&&(s=e[a],o=e.track_id)}),n.length&&(u=void 0,u=n[0].sample_rate,c=n[0].track_id,n.forEach(function(e){e.sample_rate<u&&(u=e.sample_rate,c=e.track_id)}))),e=[],o&&o.length&&e.push(o),c&&c.length&&e.push(c),e;h.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},_.prototype._play=function(o,r){var i=this;return this.liveError=!1,new Promise(function(e,t){var n;return h.logger.log("_play",o,r),i.playing?(h.logger.log(n="[mse-player] _play: terminate because already has been playing"),e({message:n})):i._pause?i.ws&&!1===i.ws.opened?(h.logger.log("WebSocket Closed, trying to restart it"),i._pause=!1,void i.restart(!0)):(h.logger.log("WebSocket is in opened state, resuming"),i._pause=!1,i._resume(),i.pauseStarted&&(n=i.playerStatsObject.application)&&(n=n.pause_duration,n+=Date.now()-i.pauseStarted,i.addPlayerStat("pause_duration",!1,n),delete i.pauseStarted),i.playPromise=i.media.play(),h.logger.log("_play: terminate because _paused and should resume"),i.playPromise):(i.resetStats(),i.playerStatsObject.opened_at=Date.now(),i.uuid=i.generateUUID(),i.addStat({opened_at:i.playerStatsObject.opened_at,id:i.uuid}),i.videoTrack=o,i.audioTrack=r,i._pause=!1,i.mediaSource||i.onAttachMedia({media:i.media}).then(function(){i.onsoa=i._play.bind(i,o,r),i.sb.setMediaSource(i.mediaSource),i.mediaSource.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,i.onsoa),h.logger.warn("mediaSource did not create"),i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t}),void(i.mediaSource&&"open"!==i.mediaSource.readyState?(h.logger.warn('readyState is not "open", it\'s currently ',i.mediaSource.readyState),i.shouldPlay=!0,i.resolveThenMediaSourceOpen=i.resolveThenMediaSourceOpen||e,i.rejectThenMediaSourceOpen=i.rejectThenMediaSourceOpen||t):new Promise(function(e,t){return!i.media.autoplay||!0===i.media.muted||i.opts.retryMuted?e():!i.onAutoplay||function(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod","Safari"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}()?(i.media.muted=!0,e()):(i.onAutoplay(function(){return i.media.muted=!1,e()}),void t())}).then(function(){i.ws.start(i.url,i.playTime,i.videoTrack,i.audioTrack).then(function(){return i.playPromise=i.media.play(),i.playPromise.then(function(){i.onStartStalling(),i.startProgressTimer(),i.resolveThenMediaSourceOpen&&(i._stop=!1,i.resolveThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0,clearInterval(i.retryConnectionTimer),i.retry=0),i.onEvent({key:Date.now(),data:{event:"play_started"}})}).catch(function(e){h.logger.log("playPromise rejection.",e),i.ws.connectionPromise&&i.ws.connectionPromise.then(function(){return i.ws.destroy()}),i.opts.retryMuted&&0==i.media.muted&&(i.onMuted&&i.onMuted(),i.media.muted=!0,i._play(o,r)),i.onPlayerError({error:"play_promise_reject",err:e}),i.rejectThenMediaSourceOpen&&(i.rejectThenMediaSourceOpen(),i.resolveThenMediaSourceOpen=void 0,i.rejectThenMediaSourceOpen=void 0),i.opts.retryMuted||i.stop(),i.opts.onCrashTryVideoOnly&&(e=i.mediaInfo.activeStreams.video)&&i._play(e)}),i.playPromise})})))})},_.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._pause=!1,this.playing=!1,this.shouldPlay=!1,this.audioTrack="",this.videoTrack="",this.endProgressTimer(),e||this.onEvent({key:Date.now(),data:{event:"play_init",userInfo:window.navigator.userAgent,playerInfo:"MSEPlayer"+(_.version?"@"+_.version:"")}})},_.prototype._resume=function(){this.ws.resume(),this.onEvent({key:Date.now(),data:{event:"play_websocket_resume"}})},_.prototype.onMediaDetaching=function(){var e=this;if(this.stopRunning)h.logger.warn("stop is running.");else{if(this.stopRunning=!0,this.handlerMediaDetaching.bind(this),!this.playPromise)return this.handlerMediaDetaching();this.playPromise.catch(function(){return e.handlerMediaDetaching()}).finally(function(){return e.handlerMediaDetaching()})}},_.prototype.handlerMediaDetaching=function(){var n=this;return h.logger.info("media source detaching"),new Promise(function(e,t){if(n.removeMediaSource(),!n.media)return t("no media to detach");n.removeListeners(),n.oncvp=null,n.mediaSource=null,n.init(!0),n.ws.destroy(),n.sb.destroy(),n.media.onemptied=function(){return h.logger.log("[mse-player]: media emptied"),n.stopRunning=!1,n._stop=!0,delete n.playPromise,e()}})},_.prototype.removeMediaSource=function(){var e=this,t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){h.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),this.onmso=null,this.onmse=null,this.onmsc=null}function n(){e.media.src="",e.media.load(),e.resetTimer&&(clearTimeout(e.resetTimer),e.resetTimer=void 0)}this.playPromise&&this.playPromise.then(function(){n()}).catch(function(){n()})},_.prototype.onMediaElementEmptied=function(e){return this.onMediaElementEmptied&&this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this.onMediaElementEmptied),this._onmee=void 0),e},_.prototype.onAttachMedia=function(e){var t=this,e=(this.media=e.media,this.media);if(!(e instanceof HTMLMediaElement))throw new Error(i.default.NOT_HTML_MEDIA_ELEMENT);if(e){var n=this.mediaSource=new MediaSource;if(this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),e.src=URL.createObjectURL(n),this.eventLog=function(e){t.onEvent&&t.onEvent(e)},this.addListeners(),!this.liveError)return new Promise(function(e){t.onmso=t.onMediaSourceOpen.bind(t,e),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,t.onmso)});this.player=void 0}},_.prototype.onMediaSourceOpen=function(e){e();e=this.mediaSource;e&&e.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),URL.revokeObjectURL(this.media.src),this.shouldPlay&&(this.shouldPlay=!1,h.logger.info("readyState now is "+this.mediaSource.readyState+", and will be played",this.audioTrack,this.videoTrack),this._play(this.audioTrack,this.videoTrack))},_.prototype.onDisconnect=function(e){this.onEvent({key:Date.now(),data:{event:"play_diconnected"}}),this.opts.onDisconnect&&this.opts.onDisconnect(e)},_.prototype.dispatchMessage=function(e){var t=this;if(!this.stopRunning){this.playerStatsObject.first_byte_at||(this.playerStatsObject.first_byte_at=Date.now(),this.addStat({first_byte_at:this.playerStatsObject.first_byte_at}));var n,o=e.rawData,r=e.parsedData,e=e.isDataAB;try{if(e){if(this.waitForInitFrame)return h.logger.log("old frames");this.sb.procArrayBuffer(o)}if(r&&r.type===p.EVENT_SEGMENT){var i=r[p.EVENT_SEGMENT];switch(h.logger.log("%c "+r.type+" "+("event"===r.type?r.event:"mse_init_segment"),"background: aquamarine;",r),i){case"resumed":this._pause&&!this.playing&&this.onStartStalling(),this.onResume&&this.onResume();break;case"paused":break;case"seeked":case"switched_to_live":if(this.seekValue=void 0,this.opts.onSeeked)try{this.opts.onSeeked()}catch(e){h.logger.error(e)}break;case"recordings_ended":this._eos=!0,this.sb.onBufferEos();break;case"stream_unavailable":"static"in r&&0==r.static?(h.logger.info("Stream is on on demand mode, waiting for init segment"),this.onStartStalling()):(h.logger.warn("do playPromise reject with error"),this.ws.connectionPromise&&this.ws.connectionPromise.then(function(){return t.ws.pause()}),this.liveError||(this.onPlayerError({error:"playPromise reject - stream unavaible"}),this.liveError=!0),this.rejectThenMediaSourceOpen&&(this.rejectThenMediaSourceOpen(),this.resolveThenMediaSourceOpen=void 0,this.rejectThenMediaSourceOpen=void 0),this.playPromise=Promise.reject("stream unavaible"),this.mediaSource.endOfStream());break;case"tracks_switched":break;default:this.opts.onEvent&&this.opts.onEvent({error:"unhandled_event",event:i}),h.logger.warn("unknown type of event",i)}}else if(r&&r.type===p.MSE_INIT_SEGMENT)return this.procInitSegment(o)}catch(e){l.showDispatchError.bind(this)(e);try{this.media.error?(this.onPlayerError({error:"Media error",mediaError:this.media.error}),this.stop()):this.mediaInfo&&this.mediaInfo.activeStreams&&(n=this.mediaInfo.activeStreams,this.setTracks([n.video||"",n.audio||""]))}catch(e){this.ws.pause()}}}},_.prototype.procInitSegment=function(e){var n=this,e=JSON.parse(e);if(e.type!==p.MSE_INIT_SEGMENT)return h.logger.warn("type is not "+p.MSE_INIT_SEGMENT);this.waitForInitFrame&&(this.waitForInitFrame=!1),this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=void 0),this.sb.isBuffered()&&(this.sb.doFlush(),this.sb.seek()),this.sb.setTracksByType(e);var t=a({},e.metadata,{tracks:e.metadata.streams||e.metadata.tracks,streams:e.metadata.streams||e.metadata.tracks}),o=e.metadata.streams,r=(e.metadata.tracks&&(o=e.metadata.tracks),{}),i=this.sb.videoTrackId&&this.sb.videoTrackId.id-1;if(o[i]&&o[i].track_id){if(o[i].bitrate&&0===o[i].bitrate||0===o[i].height||0===o[i].width)return void this.onPlayerError({error:"Video track error"});r.video=o[i].track_id}var s,i=this.sb.audioTrackId&&this.sb.audioTrackId.id-1,o=(i&&o[i]&&o[i].track_id&&(o[i].bitrate&&0===o[i].bitrate?(this.onPlayerError({error:"Audio track error"}),s=void 0,e.tracks.forEach(function(e,t){e.id===n.sb.audioTrackId.id&&(s=t)}),e.tracks.splice(s,1),this.sb.sourceBuffer.audio&&(this.mediaSource.removeSourceBuffer(this.sb.sourceBuffer.audio),delete this.sb.sourceBuffer.audio)):r.audio=o[i].track_id),a({},t,{activeStreams:r,version:_.version}));if(this.playerStatsObject.source_id=e.session_id,this.addStat({source_id:this.playerStatsObject.source_id}),this.doMediaInfo(o),h.logger.log("%cprocInitSegment:","background: lightpink;",e),this.onEvent({key:Date.now(),data:a({event:"play_metadata"},o)}),this.mediaSource&&!this.mediaSource.sourceBuffers.length&&(this.sb.setMediaSource(this.mediaSource),this.sb.createSourceBuffers(e)),this.liveError||this.sb.createTracks(e.tracks),this.opts.videoQuality&&this.firstStart){i=void 0;if("lowest"===this.opts.videoQuality?i=this.autoTrackSelection(!1):"highest"===this.opts.videoQuality&&(i=this.autoTrackSelection(!0)),i[0]!==r.video||r.audio&&i[1]!==r.audio)return void this.ws.setTracks(i[0]||"",i[1]||"");this.firstStart=!1}this.opts.preferHQ&&h.logger.info("[MSE]: preferHQ option is depricated. Use videoQuality(lowest/highest) instead"),this.ws.resume()},_.prototype.doMediaInfo=function(e){if(h.logger.log("%cmediaInfo:","background: orange;",e),this.mediaInfo=e,this.onMediaInfo)try{this.onMediaInfo(e)}catch(e){h.logger.error(l.errorMsg(e))}},_.prototype.getVideoTracks=function(){var e;if(this.mediaInfo)return e=this.mediaInfo.streams?"streams":"tracks",this.mediaInfo[e].filter(function(e){return e.content===g})},_.prototype.getAudioTracks=function(){var e;if(this.mediaInfo)return e=this.mediaInfo.streams?"streams":"tracks",this.mediaInfo[e].filter(function(e){return e.content===y})},_.prototype.immediateLevelSwitchEnd=function(){var e=this,t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,this.previouslyPaused||(this.playPromise=t.play(),this.playPromise.then(function(){e._pause=!1,e.playing=!0})))},_.prototype.onStartStalling=function(){var e=this;this._pause||(this.resetTimer||(this.resetTimer=setTimeout(function(){e.restart()},6e4)),this._stalling)||(this.opts.onStartStalling&&this.opts.onStartStalling(),this._stalling=!0,h.logger.log("onStartStalling"),this.playerStatsObject.started_at&&(this.addPlayerStat("stall_count"),this.startStallingTime=Date.now()),this.onEvent({key:Date.now(),data:{event:"play_stalled"}}))},_.prototype.onEndStalling=function(){var e;this._stalling&&(this.opts.onEndStalling&&this.opts.onEndStalling(),this._stalling=!1,h.logger.log("onEndStalling"),clearTimeout(this.resetTimer),this.resetTimer=void 0,this.startStallingTime&&(e=this.playerStatsObject.application)&&(e=e.stall_duration,e+=Date.now()-this.startStallingTime,this.startStallingTime=null,this.addPlayerStat("stall_duration",!1,e)),this.onEvent({key:Date.now(),data:{event:"play_resumed"}}))},_.prototype.startProgressTimer=function(){this.timer=setInterval(this.onTimer.bind(this),this.opts.progressUpdateTime)},_.prototype.endProgressTimer=function(){clearInterval(this.timer),this.timer=void 0},_.prototype.onTimer=function(){if(this._eos)return h.logger.log("nothing to play");if(this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.sb.lastLoadedUTC!==this.utcPrev&&!this._stalling&&(this.utcPrev=this.sb.lastLoadedUTC,this.onProgress))try{this.onProgress(this.sb.lastLoadedUTC)}catch(e){h.logger.error(l.errorMsg(e))}},_.prototype.onMediaSourceEnded=function(){h.logger.log("media source ended");try{this.opts.onEOS&&this.opts.onEOS()}catch(e){h.logger.error("error while proccessing onEOS")}},_.prototype.onMediaSourceClose=function(){h.logger.log("media source closed")},_.prototype.onConnectionRetry=function(){var e=this;this.retryConnectionTimer||this._stop?this.retry>=this.opts.connectionRetries&&clearInterval(this.retryConnectionTimer):this.retry<this.opts.connectionRetries&&(this.retryConnectionTimer=setInterval(function(){return e.retryConnection()},5e3))},_.prototype.loadingIndication=function(e){e=e.type;"playing"===e?(this.playing=!0,this.onEndStalling(),this.playerStatsObject.started_at||(this.playerStatsObject.started_at=Date.now(),this.addStat({started_at:this.playerStatsObject.started_at}))):"waiting"===e&&(this.playing=!1,this.onStartStalling())},_.prototype.onEvent=function(e){this.onEventCallback&&this.onEventCallback(e)},_.prototype.onPlayerError=function(e){this.playerStatsObject&&this.addPlayerStat("error_count"),this.onError&&this.onError(e)},_.prototype.addListeners=function(){this.media&&(this.oncvp=l.checkVideoProgress(this.media,this).bind(this),this.media.addEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.addEventListener(f.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication.bind(this)),this.media.addEventListener(f.default.MEDIA_ELEMENT_WAITING,this.loadingIndication.bind(this)))},_.prototype.removeListeners=function(){this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),this.media.removeEventListener(f.default.MEDIA_ELEMENT_PLAYING,this.loadingIndication),this.media.removeEventListener(f.default.MEDIA_ELEMENT_WAITING,this.loadingIndication))},_.prototype.generateUUID=function(){var n=(new Date).getTime(),o="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return 0<n?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"===e?t:3&t|8).toString(16)})},_.prototype.addPlayerStat=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=this.playerStatsObject.application;o&&(n?o[e]=Math.round(n):t&&o[e]++,this.playerStatsObject.application=o,this.addStat({application:o}))},_.prototype.addStat=function(e){this.statsWorker&&this.statsWorker.postMessage({command:"add",commandObj:e})},_.prototype.getStats=function(){return a({},this.playerStatsObject,{id:this.uuid})},_.prototype.onStatsWorkerMessage=function(){var e;this.playerStatsObject.started_at&&this.opts.statsSendEnable&&(e=(this.playerStatsObject&&this.playerStatsObject.source_id||{}).source_id,e=this.url.replace(/sessions/,"sessions/"+(e?""+e:"")),fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",body:JSON.stringify(this.getStats())}))},t.default=_,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWSURL=u;var d=r(n(9)),o=r(n(18)),l=n(0);function r(e){return e&&e.__esModule?e:{default:e}}var h="live";function i(e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.opts=e,this.init(),this.onwso=this.open.bind(this),this.onwsm=this.handleReceiveMessage.bind(this),this.onwse=this.handleError.bind(this),this.onwsc=this.onWSClose.bind(this)}function u(e,t,n,o){var r,i,s,a,u,c=t=h;return c||n||o?((i=(r="",d.default)({url:e})).query&&(r=i.query.split("&").map(function(e){return e.split("=")}).filter(function(e){return"from"!==e[0]&&"tracks"!==e[0]}).map(function(e){return e.join("=")}).join("&"),l.logger.log(r)),i=i.protocol+"//"+i.host+i.pathname+"?",a=(s=!!n||!!o)&&c&&c!==h?"&":"",u=t===h?"":"from="+Math.floor(c),i+(s?"tracks="+n+o:"")+a+(u=t?u:"")+((s||c&&c!==h)&&r?"&":"")+r):e}i.prototype.init=function(){this.wsWorker&&delete this.wsWorker,this.opened=!1,this.connectionPromise=void 0,clearTimeout(this.reconnect),this.reconnect=void 0,window.Worker&&(this.wsWorker=new o.default,this.wsWorker.onmessage=this.onWorkerMessage.bind(this))},i.prototype.onWorkerMessage=function(e){var t=e.data;switch(t.command){case"connect":this.open();break;case"close":this.onWSClose(t);break;case"error":this.handleError(t);break;default:this.handleReceiveMessage(t)}},i.prototype.start=function(o,r){var i=this,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";return this.connectionPromise=new Promise(function(e,t){i.socketURL={url:o,time:r,videoTrack:s,audioTack:a};var n=u(o,0,s,a);i.wsWorker.postMessage({command:"start",commandObj:n}),i._openingResolve=e,i._openingReject=t}),this.connectionPromise},i.prototype.open=function(){this.opened||(this.opened=!0,this.paused=!0,this._openingResolve())},i.prototype.send=function(e){this.wsWorker.postMessage({command:"send",commandObj:e})},i.prototype.resume=function(){clearTimeout(this.reconnect),l.logger.log("ws: send resume"),this.send("resume"),this.paused=!1},i.prototype.pause=function(){l.logger.log("ws: send pause"),this.send("pause"),this.paused=!0},i.prototype.seek=function(e){var t=e===h?"":"play_from=";l.logger.log(t+e),this.send(t+e)},i.prototype.setTracks=function(e){this.send("set_tracks="+e+(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null))},i.prototype.sendStats=function(e){e=JSON.stringify(e);this.send(e)},i.prototype.handleReceiveMessage=function(e){this.opts.message(e)},i.prototype.handleError=function(){var e;this.opts.error&&(e=this.opts).error.apply(e,arguments)},i.prototype.onWSClose=function(e){var t,n,o,r,i=this;l.logger.log("WebSocket lost connection with code ",e.code+" and reason: "+e.reason),this.opts.error&&this.opts.error({error:"WebSocket lost connection",err:"WebSocket lost connection with code "+e.code+" and reason: "+e.reason,code:e.code}),this.opts.wsReconnect&&(e.wasClean&&1e3!==e.code&&1006!==e.code?(l.logger.log("Clean websocket stop"),this.destroy()):(t=this.socketURL,n=t.url,o=t.videoTrack,r=t.audioTack,this.reconnect=setTimeout(function(){i.start(n,o,r).then(function(){clearTimeout(i.reconnect)}).catch(function(){i.destroy()})},5e3))),this.opts.closed&&this.opts.closed(e)},i.prototype.destroy=function(){this.wsWorker.postMessage({command:"disconnect"}),clearTimeout(this.reconnect),this.reconnect=void 0,this.init()},t.default=i},function(e,t,n){"use strict";
/*!
 * parseurl
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var n=n(10),s=n.parse,a=n.Url;function o(e){var t,n=e.url;if(void 0!==n)return i(n,t=e._parsedUrl)?t:((t=r(n))._raw=n,e._parsedUrl=t)}function r(e){if("string"!=typeof e||47!==e.charCodeAt(0))return s(e);for(var t=e,n=null,o=null,r=1;r<e.length;r++)switch(e.charCodeAt(r)){case 63:null===o&&(t=e.substring(0,r),n=e.substring(r+1),o=e.substring(r));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return s(e)}var i=void 0!==a?new a:{};return i.path=e,i.href=e,i.pathname=t,null!==o&&(i.query=n,i.search=o),i}function i(e,t){return"object"==typeof t&&null!==t&&(void 0===a||t instanceof a)&&t._raw===e}e.exports=o,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return o(e);var n=e._parsedOriginalUrl;if(i(t,n))return n;return(n=r(t))._raw=t,e._parsedOriginalUrl=n}},function(e,t,n){"use strict";var w=n(11),k=n(14);function S(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=r,t.resolve=function(e,t){return r(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?r(e,!1,!0).resolveObject(t):t},t.format=function(e){k.isString(e)&&(e=r(e));return e instanceof S?e.format():S.prototype.format.call(e)},t.Url=S;var T=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,M=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,t=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),O=["'"].concat(t),j=["%","/","?",";","#"].concat(O),I=["/","?","#"],P=/^[+a-z0-9A-Z_-]{0,63}$/,x=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,A={javascript:!0,"javascript:":!0},D={javascript:!0,"javascript:":!0},B={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},U=n(15);function r(e,t,n){var o;return e&&k.isObject(e)&&e instanceof S?e:((o=new S).parse(e,t,n),o)}S.prototype.parse=function(e,t,n){if(!k.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),o=-1!==o&&o<e.indexOf("#")?"?":"#",r=e.split(o);r[0]=r[0].replace(/\\/g,"/");var i=(i=e=r.join(o)).trim();if(!n&&1===e.split("#").length){r=M.exec(i);if(r)return this.path=i,this.href=i,this.pathname=r[1],r[2]?(this.search=r[2],this.query=t?U.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var s,o=T.exec(i);if(o&&(s=(o=o[0]).toLowerCase(),this.protocol=s,i=i.substr(o.length)),!(n||o||i.match(/^\/\/[^@\/]+@[^@\/]+/))||!(b="//"===i.substr(0,2))||o&&D[o]||(i=i.substr(2),this.slashes=!0),!D[o]&&(b||o&&!B[o])){for(var a=-1,u=0;u<I.length;u++)-1!==(c=i.indexOf(I[u]))&&(-1===a||c<a)&&(a=c);-1!==(e=-1===a?i.lastIndexOf("@"):i.lastIndexOf("@",a))&&(r=i.slice(0,e),i=i.slice(e+1),this.auth=decodeURIComponent(r));for(var c,a=-1,u=0;u<j.length;u++)-1!==(c=i.indexOf(j[u]))&&(-1===a||c<a)&&(a=c);-1===a&&(a=i.length),this.host=i.slice(0,a),i=i.slice(a),this.parseHost(),this.hostname=this.hostname||"";n="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!n)for(var d=this.hostname.split(/\./),u=0,l=d.length;u<l;u++){var h=d[u];if(h&&!h.match(P)){for(var p="",f=0,m=h.length;f<m;f++)127<h.charCodeAt(f)?p+="x":p+=h[f];if(!p.match(P)){var g=d.slice(0,u),y=d.slice(u+1),_=h.match(x);_&&(g.push(_[1]),y.unshift(_[2])),y.length&&(i="/"+y.join(".")+i),this.hostname=g.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),n||(this.hostname=w.toASCII(this.hostname));var v=this.port?":"+this.port:"",b=this.hostname||"";this.host=b+v,this.href+=this.host,n&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0])&&(i="/"+i)}if(!A[s])for(u=0,l=O.length;u<l;u++){var S,E=O[u];-1!==i.indexOf(E)&&((S=encodeURIComponent(E))===E&&(S=escape(E)),i=i.split(E).join(S))}o=i.indexOf("#"),-1!==o&&(this.hash=i.substr(o),i=i.slice(0,o)),e=i.indexOf("?");return-1!==e?(this.search=i.substr(e),this.query=i.substr(e+1),t&&(this.query=U.parse(this.query)),i=i.slice(0,e)):t&&(this.search="",this.query={}),i&&(this.pathname=i),B[s]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(v=this.pathname||"",r=this.search||"",this.path=v+r),this.href=this.format(),this},S.prototype.format=function(){var e=this.auth||"",t=(e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@"),this.protocol||""),n=this.pathname||"",o=this.hash||"",r=!1,i="",e=(this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port)&&(r+=":"+this.port),this.query&&k.isObject(this.query)&&Object.keys(this.query).length&&(i=U.stringify(this.query)),this.search||i&&"?"+i||"");return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||B[t])&&!1!==r?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r=r||"",o&&"#"!==o.charAt(0)&&(o="#"+o),e&&"?"!==e.charAt(0)&&(e="?"+e),t+r+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(e=e.replace("#","%23"))+o},S.prototype.resolve=function(e){return this.resolveObject(r(e,!1,!0)).format()},S.prototype.resolveObject=function(e){k.isString(e)&&((h=new S).parse(e,!1,!0),e=h);for(var t=new S,n=Object.keys(this),o=0;o<n.length;o++){var r=n[o];t[r]=this[r]}if(t.hash=e.hash,""!==e.href)if(e.slashes&&!e.protocol){for(var i=Object.keys(e),s=0;s<i.length;s++){var a=i[s];"protocol"!==a&&(t[a]=e[a])}B[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/")}else if(e.protocol&&e.protocol!==t.protocol)if(B[e.protocol]){if(t.protocol=e.protocol,e.host||D[e.protocol])t.pathname=e.pathname;else{for(var u=(e.pathname||"").split("/");u.length&&!(e.host=u.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==u[0]&&u.unshift(""),u.length<2&&u.unshift(""),t.pathname=u.join("/")}t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(h=t.pathname||"",p=t.search||"",t.path=h+p),t.slashes=t.slashes||e.slashes}else for(var c=Object.keys(e),d=0;d<c.length;d++){var l=c[d];t[l]=e[l]}else{var h=t.pathname&&"/"===t.pathname.charAt(0),p=e.host||e.pathname&&"/"===e.pathname.charAt(0),h=p||h||t.host&&e.pathname,f=h,m=t.pathname&&t.pathname.split("/")||[],u=e.pathname&&e.pathname.split("/")||[],g=t.protocol&&!B[t.protocol];if(g&&(t.hostname="",t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===u[0]?u[0]=e.host:u.unshift(e.host)),e.host=null),h=h&&(""===u[0]||""===m[0])),p)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,m=u;else if(u.length)(m=m||[]).pop(),m=m.concat(u),t.search=e.search,t.query=e.query;else if(!k.isNullOrUndefined(e.search))return g&&(t.hostname=t.host=m.shift(),b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift()),t.search=e.search,t.query=e.query,k.isNull(t.pathname)&&k.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(m.length){for(var y=m.slice(-1)[0],p=(t.host||e.host||1<m.length)&&("."===y||".."===y)||""===y,_=0,v=m.length;0<=v;v--)"."===(y=m[v])?m.splice(v,1):".."===y?(m.splice(v,1),_++):_&&(m.splice(v,1),_--);if(!h&&!f)for(;_--;)m.unshift("..");!h||""===m[0]||m[0]&&"/"===m[0].charAt(0)||m.unshift(""),p&&"/"!==m.join("/").substr(-1)&&m.push("");var b,f=""===m[0]||m[0]&&"/"===m[0].charAt(0);g&&(t.hostname=t.host=!f&&m.length?m.shift():"",b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift()),(h=h||t.host&&m.length)&&!f&&m.unshift(""),m.length?t.pathname=m.join("/"):(t.pathname=null,t.path=null),k.isNull(t.pathname)&&k.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes}else t.pathname=null,t.search?t.path="/"+t.search:t.path=null}return t.href=t.format(),t},S.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,m,T){!function(e,t){var n,g,y,_,r,i,o,s,a,u,c,v,b;/*! https://mths.be/punycode v1.4.1 by @mathias */function S(e){throw new RangeError(u[e])}function d(e,t){for(var n=e.length,o=[];n--;)o[n]=t(e[n]);return o}function l(e,t){var n=e.split("@"),o="",n=(1<n.length&&(o=n[0]+"@",e=n[1]),(e=e.replace(a,".")).split("."));return o+d(n,t).join(".")}function E(e){for(var t,n,o=[],r=0,i=e.length;r<i;)55296<=(t=e.charCodeAt(r++))&&t<=56319&&r<i?56320==(64512&(n=e.charCodeAt(r++)))?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),r--):o.push(t);return o}function f(e){return d(e,function(e){var t="";return 65535<e&&(t+=b((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=b(e)}).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,n){var o=0;for(e=n?v(e/i):e>>1,e+=v(e/t);c*_>>1<e;o+=y)e=v(e/c);return v(o+(c+1)*e/(e+r))}function h(e){var t,n,o,r,i,s,a,u=[],c=e.length,d=0,l=128,h=72,p=e.lastIndexOf("-");for(p<0&&(p=0),n=0;n<p;++n)128<=e.charCodeAt(n)&&S("not-basic"),u.push(e.charCodeAt(n));for(o=0<p?p+1:0;o<c;){for(r=d,i=1,s=y;c<=o&&S("invalid-input"),a=e.charCodeAt(o++),(y<=(a=a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:y)||a>v((g-d)/i))&&S("overflow"),d+=a*i,!(a<(a=s<=h?1:h+_<=s?_:s-h));s+=y)i>v(g/(a=y-a))&&S("overflow"),i*=a;h=k(d-r,t=u.length+1,0==r),v(d/t)>g-l&&S("overflow"),l+=v(d/t),d%=t,u.splice(d++,0,l)}return f(u)}function p(e){for(var t,n,o,r,i,s,a,u,c,d,l=[],h=(e=E(e)).length,p=128,f=72,m=t=0;m<h;++m)(a=e[m])<128&&l.push(b(a));for(n=o=l.length,o&&l.push("-");n<h;){for(r=g,m=0;m<h;++m)p<=(a=e[m])&&a<r&&(r=a);for(r-p>v((g-t)/(u=n+1))&&S("overflow"),t+=(r-p)*u,p=r,m=0;m<h;++m)if((a=e[m])<p&&++t>g&&S("overflow"),a==p){for(i=t,s=y;!(i<(c=s<=f?1:f+_<=s?_:s-f));s+=y)l.push(b(w(c+(d=i-c)%(c=y-c),0))),i=v(d/c);l.push(b(w(i,0))),f=k(t,u,n==o),t=0,++n}++t,++p}return l.join("")}m&&m.nodeType,e&&e.nodeType,(t="object"==typeof t&&t).global!==t&&t.window!==t&&t.self,g=2147483647,_=26,r=38,i=700,o=/^xn--/,s=/[^\x20-\x7E]/,a=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c=(y=36)-1,v=Math.floor,b=String.fromCharCode,n={version:"1.4.1",ucs2:{decode:E,encode:f},decode:h,encode:p,toASCII:function(e){return l(e,function(e){return s.test(e)?"xn--"+p(e):e})},toUnicode:function(e){return l(e,function(e){return o.test(e)?h(e.slice(4).toLowerCase()):e})}},void 0!==(t=function(){return n}.call(m,T,m,e))&&(e.exports=t)}.call(this,T(12)(e),T(13))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(16),t.encode=t.stringify=n(17)},function(e,t,n){"use strict";e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var r={};if("string"==typeof e&&0!==e.length){var i=/\+/g,t=(e=e.split(t),1e3),s=(o&&"number"==typeof o.maxKeys&&(t=o.maxKeys),e.length);0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var u,c=e[a].replace(i,"%20"),d=c.indexOf(n),d=0<=d?(u=c.substr(0,d),c.substr(d+1)):(u=c,""),c=decodeURIComponent(u),d=decodeURIComponent(d);Object.prototype.hasOwnProperty.call(r,c)?l(r[c])?r[c].push(d):r[c]=[r[c],d]:r[c]=d}}return r};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function i(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(n,o,r,e){return o=o||"&",r=r||"=","object"==typeof(n=null===n?void 0:n)?a(u(n),function(e){var t=encodeURIComponent(i(e))+r;return s(n[e])?a(n[e],function(e){return t+encodeURIComponent(i(e))}).join(o):t+encodeURIComponent(i(n[e]))}).join(o):e?encodeURIComponent(i(e))+r+encodeURIComponent(i(n)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var n=[],o=0;o<e.length;o++)n.push(t(e[o],o));return n}var u=Object.keys||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,r.default)("/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\n(function () {\n  //Define WebSocket and protocol variables\n  let websocket = null;\n  let mustStop = false;\n\n  //Define based object response to WebSocketController\n  // let onMessage_response = {\n  //   command: 'incomingMsg',\n  //   msg: null,\n  // }\n\n  //Receive message from WebSocketController\n  self.addEventListener(\n    'message',\n    function (e) {\n      let data = e.data;\n      //Get command parameter to identify operation\n      let command = data.command;\n\n      if (command === 'start') {\n        start(data.commandObj); //Establish WebSocket connection\n        // } else if (command === 'logout') {\n        //   sendOMMmessage(data.commandObj)\n        //   disconnect() //Terminate WebSocket connection\n      } else if (command === 'disconnect') {\n        disconnect();\n      } else if (command === 'send') {\n        sendOMMmessage(data.commandObj);\n      }\n    },\n    false\n  );\n\n  /* -----------------  Application events functions  ----------------- */\n\n  //Establish WebSocket connection\n  function start(wsURL) {\n    websocket = new WebSocket(wsURL);\n    websocket.binaryType = 'arraybuffer';\n    websocket.onopen = onOpen;\n    websocket.onmessage = onMessage;\n    websocket.onerror = onError;\n    websocket.onclose = onClose;\n  }\n\n  function disconnect() {\n    if (websocket) {\n      websocket.close();\n    }\n    mustStop = true;\n    const disconnect_response = {\n      command: 'disconnect',\n      msg: 'Disconnected',\n    };\n    self.postMessage(disconnect_response);\n  }\n\n  //Send message to ADS WebSocket\n  function sendOMMmessage(commandObj) {\n    websocket.send(commandObj);\n  }\n\n  /* -----------------  WS events  ----------------- */\n\n  //Establish WebSocket connection success\n  function onOpen() {\n    const onOpen_response = {\n      command: 'connect',\n      msg: 'Connected',\n    };\n    self.postMessage(onOpen_response);\n  }\n\n  //Receives incoming message from WebSocket\n  function onMessage(event) {\n    const rawData = event.data;\n    const isDataAB = rawData instanceof ArrayBuffer;\n    const parsedData = !isDataAB ? JSON.parse(rawData) : void 0;\n    self.postMessage({ rawData, parsedData, isDataAB });\n  }\n\n  function onError(event) {\n    const onError_response = {\n      command: 'error',\n      msg: JSON.stringify(event),\n    };\n    self.postMessage(onError_response);\n  }\n\n  function onClose(e) {\n    if (mustStop) {\n      return;\n    }\n    const { code, reason } = e;\n    const onClose_response = {\n      command: 'close',\n      data: { code, reason },\n    };\n    self.postMessage(onClose_response);\n  }\n})();\n\n\n/***/ })\n/******/ ]);","Worker",void 0,n.p+"ws.worker.js")};var o=n(1),r=(o=o)&&o.__esModule?o:{default:o};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),l=n(0),i=n(3),s=n(4);var a="segments";function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,n=r;if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");l.logger.log("create BuffersController"),this.media=e.media,this.init(e),this.doArrayBuffer=o.doArrayBuffer.bind(this),this.maybeAppend=this.maybeAppend.bind(this),this.onSBUpdateEnd=this.onSBUpdateEnd.bind(this),this.onAudioSBUpdateEnd=this.onAudioSBUpdateEnd.bind(this)}r.prototype.init=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.flushRange=[],this.appended=0,this.mediaSource=e.mediaSource,this.segmentsVideo=[],this.segmentsAudio=[],this.sourceBuffer={},this.totalBytesCollected=0},r.prototype.setMediaSource=function(e){this.mediaSource=e},r.prototype.createSourceBuffers=function(e){var o=this,r=this.sourceBuffer;e.tracks.forEach(function(e){var t=e.content===i.VIDEO,n=t?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"',n=(e.mime_type&&(n=e.mime_type),r[e.content]=o.mediaSource.addSourceBuffer(n),r[e.content].mode=a,r[e.content]);t?n.addEventListener(s.BUFFER_UPDATE_END,o.onSBUpdateEnd):n.addEventListener(s.BUFFER_UPDATE_END,o.onAudioSBUpdateEnd)})},r.prototype.onSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),!this._needsFlush&&this.segmentsVideo.length&&(e=this.sourceBuffer.video)&&!e.updating&&(t=this.segmentsVideo[0],e.appendBuffer(t.data),this.segmentsVideo.shift(),this.videoBufferSize=this.videoBufferSize-t.data.byteLength,this.appended++)},r.prototype.onAudioSBUpdateEnd=function(){var e,t;this._needsEos&&this.checkEos(),!this._needsFlush&&this.segmentsAudio.length&&(e=this.sourceBuffer.audio)&&!e.updating&&(t=this.segmentsAudio[0],e.appendBuffer(t.data),this.segmentsAudio.shift(),this.appended++)},r.prototype.createTracks=function(e){var n=this;e.forEach(function(e){var t=(0,o.base64ToArrayBuffer)(e.payload),e={type:n.getTypeBytrackId(e.id),isInit:!0,data:t};n.maybeAppend(e)})},r.prototype.maybeAppend=function(e){var t;this._needsFlush||(!this.media||this.media.error?("audio"===e.type?this.segmentsAudio=[]:this.segmentsVideo=[],l.logger.error("trying to append although a media error occured, flush segment and abort"),this.media.error&&l.logger.error("Error code:",this.media.error)):(t=this.sourceBuffer[e.type])&&!t.updating&&(t.appendBuffer(e.data),("audio"===e.type?this.segmentsAudio:this.segmentsVideo).shift(),this.appended++))},r.prototype.setTracksByType=function(e){var n=this,t=e.tracks?"tracks":"streams";1===e[t].length&&(this.audioTrackId=null),e[t].forEach(function(e,t){n[e.content===i.VIDEO?"videoTrackId":"audioTrackId"]={index:t,id:e.id}})},r.prototype.getTypeBytrackId=function(e){return this.audioTrackId&&this.audioTrackId.id===e?i.AUDIO:i.VIDEO},r.prototype.procArrayBuffer=function(e){e=this.rawDataToSegmnet(e);("audio"===e.type?this.segmentsAudio:this.segmentsVideo).push(e),this.totalBytesCollected=this.totalBytesCollected+e.data.byteLength,this.doArrayBuffer(e),this.sourceBuffer&&(this.sourceBuffer.video&&!this.sourceBuffer.video.updating&&this.onSBUpdateEnd(),this.audioTrackId)&&this.sourceBuffer.audio&&!this.sourceBuffer.audio.updating&&this.onAudioSBUpdateEnd()},r.prototype.seek=function(){for(var e in this.sourceBuffer)this.sourceBuffer[e].abort(),this.sourceBuffer[e].mode=a},r.prototype.isBuffered=function(){var e,t=0,n=this.sourceBuffer;for(e in n)t+=n[e].buffered.length;return 0<t},r.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var o in n)t+=n[o].buffered.length}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this._setTracksFlag=!1}},r.prototype.flushBuffer=function(e,t,n){var o,r,i=void 0,s=void 0,a=void 0,u=void 0,c=this.sourceBuffer;if(Object.keys(c).length){if(l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var d in c)if(!n||d===n){if((i=c[d]).ended=!1,i.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;try{for(s=0;s<i.buffered.length;s++)if(o=i.buffered.start(s),r=i.buffered.end(s),u=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(a=e,t):(a=Math.max(o,e),Math.min(r,t)),.5<Math.min(u,r)-a)return this.flushBufferCounter++,l.logger.log("flush "+d+" ["+a+","+u+"], of ["+o+","+r+"], pos:"+this.media.currentTime),i.remove(a,u),!1}catch(e){l.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else l.logger.warn("abort flushing too many retries");l.logger.log("buffer flushed")}return!0},r.prototype.rawDataToSegmnet=function(e){var e=new Uint8Array(e),t=(0,o.getTrackId)(e);return{type:this.getTypeBytrackId(t),data:e}},r.prototype.onBufferEos=function(){var e,t=this.sourceBuffer,n=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type;for(e in t)n&&e!==n||t[e].ended||(t[e].ended=!0,l.logger.log(e+" sourceBuffer now EOS"));this.checkEos()},r.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){n=e[n];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}l.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}}this._needsEos=!1},r.prototype.addSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer,t=(t[e]=this.mediaSource.addSourceBuffer("video"===e?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"'),t[e].mode=a,t[e]);"video"===e?t.addEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd):t.addEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd)},r.prototype.removeSourceBuffer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"audio",t=this.sourceBuffer[e];"audio"===e?t.removeEventListener(s.BUFFER_UPDATE_END,this.onAudioSBUpdateEnd):t.removeEventListener(s.BUFFER_UPDATE_END,this.onSBUpdateEnd),this.mediaSource.removeSourceBuffer(t),delete this.sourceBuffer[e]},r.prototype.destroy=function(){this.init()},t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,r.default)("/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\n(function () {\n  let statsURL = null;\n  let sendTime = 60000;\n  let jsonTable = {};\n  let sendingInterval = null;\n\n  self.addEventListener(\n    'message',\n    function (e) {\n      let data = e.data;\n      //Get command parameter to identify operation\n      const { command, commandObj } = data;\n      switch (command) {\n        case 'start':\n          statsURL = commandObj\n            .replace(/ws:/, 'http:')\n            .replace(/wss:/, 'https:')\n            .replace(/mse_ld/, 'sessions');\n          start();\n          break;\n        case 'time':\n          correctSendTime(commandObj);\n          break;\n        case 'stop':\n          stop();\n          break;\n        case 'add':\n          addToTable(commandObj);\n          break;\n        default:\n          break;\n      }\n    },\n    false\n  );\n\n  function correctSendTime(time) {\n    sendTime = time;\n  }\n\n  function start() {\n    sendingInterval = this.setInterval(() => {\n      post();\n    }, sendTime);\n  }\n\n  function stop() {\n    post();\n    clearInterval(sendingInterval);\n  }\n\n  function addToTable(data) {\n    jsonTable = { ...jsonTable, ...data };\n\n    if (data.event && data.event === 'play_stop') {\n      stop();\n    }\n  }\n\n  // function roughSizeOfObject(object) {\n  //   let objectList = [];\n  //   let stack = [object];\n  //   let bytes = 0;\n\n  //   while (stack.length) {\n  //     let value = stack.pop();\n\n  //     if (typeof value === 'boolean') {\n  //       bytes += 4;\n  //     } else if (typeof value === 'string') {\n  //       bytes += value.length * 2;\n  //     } else if (typeof value === 'number') {\n  //       bytes += 8;\n  //     } else if (typeof value === 'object' && objectList.indexOf(value) === -1) {\n  //       objectList.push(value);\n\n  //       for (let i in value) {\n  //         stack.push(value[i]);\n  //       }\n  //     }\n  //   }\n  //   return bytes;\n  // }\n\n  function post() {\n    if (!jsonTable.started_at) {\n      return;\n    }\n\n    const { source_id } = jsonTable;\n    const newUrl = statsURL.replace(/sessions/, `sessions/${source_id ? `${source_id}` : ''}`);\n    fetch(newUrl, {\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n      method: 'PUT',\n      body: JSON.stringify(jsonTable),\n    });\n  }\n})();\n\n\n/***/ })\n/******/ ]);","Worker",void 0,n.p+"stats.worker.js")};var o=n(1),r=(o=o)&&o.__esModule?o:{default:o};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_SEGMENT="event",t.MSE_INIT_SEGMENT="mse_init_segment",t.MSE_MEDIA_SEGMENT="mse_media_segment"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NOT_HTML_MEDIA_ELEMENT:"media should be an HTMLMediaElement instance"},e.exports=t.default}],o={},r.m=n,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5);function r(e){var t;return(o[e]||(t=o[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var n,o},e.exports=o()}}]);